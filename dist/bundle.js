(()=>{"use strict";class e{constructor(){this._appVersion=null,this._isInitialized=!1}static getInstance(){return e.instance||(e.instance=new e),e.instance}init(e){this._isInitialized?console.warn("AppConfig already initialized - ignoring new data"):(this._appVersion=e,this._isInitialized=!0)}get pages(){var e;return(null===(e=this._appVersion)||void 0===e?void 0:e.Pages)||null}get theme(){var e;return(null===(e=this._appVersion)||void 0===e?void 0:e.SDT_Theme)||null}get homePage(){var e;return(null===(e=this.pages)||void 0===e?void 0:e.find((e=>"Home"===e.PageName)))||null}getPage(e){var t;return(null===(t=this.pages)||void 0===t?void 0:t.find((t=>t.PageId===e)))||null}pageContentStructure(e){var t,n;return null===(n=null===(t=this.pages)||void 0===t?void 0:t.find((t=>t.PageId===e)))||void 0===n?void 0:n.PageContentStructure}pageMenuStructure(e){var t,n;return null===(n=null===(t=this.pages)||void 0===t?void 0:t.find((t=>t.PageId===e)))||void 0===n?void 0:n.PageMenuStructure}tileParentPage(e){var t;for(const n of this.pages||[])if(null===(t=n.PageMenuStructure)||void 0===t?void 0:t.Rows){let t=!1;for(const i of n.PageMenuStructure.Rows){if(i.Tiles)for(const n of i.Tiles)if(n.Id===e){t=!0;break}if(t)break}if(t)return n}return null}}e.instance=null;class t{constructor(){this.version=e.getInstance()}getTheme(){return this.version.theme}getThemeIcons(){var e;return null===(e=this.version.theme)||void 0===e?void 0:e.Icons}getThemeColors(){var e;return null===(e=this.version.theme)||void 0===e?void 0:e.Colors}getThemeCtaColors(){var e;return null===(e=this.version.theme)||void 0===e?void 0:e.CtaColors}getThemeColor(e){var t,n;return null===(n=null===(t=this.getThemeColors())||void 0===t?void 0:t.find((t=>t.ColorName===e)))||void 0===n?void 0:n.ColorCode}getThemeCtaColor(e){var t,n;return null===(n=null===(t=this.getThemeCtaColors())||void 0===t?void 0:t.find((t=>t.ColorName===e)))||void 0===n?void 0:n.ColorCode}getThemeIcon(e){var t,n;return null===(n=null===(t=this.getThemeIcons())||void 0===t?void 0:t.find((t=>t.IconName===e)))||void 0===n?void 0:n.IconSVG}}class n{constructor(){this.header=document.createElement("div"),this.init()}init(){this.header.classList.add("tbap-header");const e=document.createElement("span");e.id="clock",e.innerText="8:34 PM";const t=document.createElement("span");t.classList.add("icons");const n=document.createElement("i");n.classList.add("fas","fa-signal");const i=document.createElement("i");i.classList.add("fas","fa-wifi");const a=document.createElement("i");a.classList.add("fas","fa-battery"),t.appendChild(n),t.appendChild(i),t.appendChild(a),this.header.appendChild(e),this.header.appendChild(t)}render(e){e.appendChild(this.header)}}class i{htmlData(){let e=`\n        <div class="tbap-date-selector">\n          <span class="tbap-arrow">❮</span>\n          <span class="tbap-date-text" id="current-date">${this.formatDate()}</span>\n          <span class="tbap-arrow">❯</span>\n        </div>\n        <div class="tbap-schedule" id="schedule-container">\n      `;for(let t=0;t<24;t++)e+=`\n            <div class="tbap-time-slot">\n              <div class="tbap-time">${t.toString().padStart(2,"0")+":00"}</div>\n              <div class="tbap-events"></div>\n              ${t===(new Date).getHours()?'\n                <div class="tbap-current-time-indicator"></div>\n                <div class="tbap-current-time-dot"></div>':""}\n            </div>\n          `;return e+="</div>",e}formatDate(){return(new Date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/(\d{2} \w{3}) (\d{4})/,"$1, $2")}renderContent(e){const t=document.createElement("div");for(t.innerHTML=this.htmlData();t.firstChild;)e.appendChild(t.firstChild)}}class a{constructor(e){this.pageId=e.PageId,this.pageData=e.PageContentStructure}renderImage(e){const t=document.createElement("div");t.classList.add("tbap-image-container");const n=document.createElement("img");return n.src=null==e?void 0:e.ContentValue,t.appendChild(n),t}renderDescription(e){const t=document.createElement("div");return t.classList.add("tbap-description-container"),t.innerHTML=null==e?void 0:e.ContentValue,t}renderContent(e){var t,n;if(!(null===(n=null===(t=this.pageData)||void 0===t?void 0:t.Content)||void 0===n?void 0:n.length)){const t=document.createElement("div");return t.className="tbap-empty",t.innerText="No content available",void e.appendChild(t)}const i=document.createElement("div");i.className="tbap-content-column",this.pageData.Content.forEach((e=>{let t=null;"Image"===e.ContentType&&e.ContentValue?t=this.renderImage(e):"Description"===e.ContentType&&e.ContentValue&&(t=this.renderDescription(e)),t&&i.appendChild(t)})),this.pageData.Cta.forEach((e=>{})),e.appendChild(i)}}class s{constructor(e){this.pageId=e.PageId,this.pageData=e.PageMenuStructure}renderRow(e,t){const n=1===e.Tiles.length,i=t&&n,a=document.createElement("div");return a.className="tbap-row",a.id=e.Id,e.Tiles.forEach(((e,t)=>{const n=new m(e,i&&0===t,this.pageId);a.appendChild(n.getElement())})),a}renderContent(e){var t,n;if(!(null===(n=null===(t=this.pageData)||void 0===t?void 0:t.Rows)||void 0===n?void 0:n.length)){const t=document.createElement("div");return t.className="tbap-empty",t.innerText="No content available",void e.appendChild(t)}const i=document.createElement("div");i.className="tbap-column",this.pageData.Rows.forEach(((e,t)=>{const n=0===t,a=this.renderRow(e,n);i.appendChild(a)})),e.appendChild(i)}}class r{renderContent(e){const t=document.createElement("div");t.className="tbap-chat-container";const n=document.createElement("div");n.className="tbap-toggle-buttons";const i=document.createElement("button");i.style.backgroundColor="#5068a8",i.style.borderRadius="6px",i.innerText="Messages";const a=document.createElement("button");a.style.backgroundColor="#e1e1e1",a.style.borderRadius="6px",a.style.color="#262626",a.innerText="Requests",n.appendChild(i),n.appendChild(a);const s=document.createElement("div");s.className="tbap-chat-body",s.innerText="No messages yet",t.appendChild(n),t.appendChild(s),e.appendChild(t)}}class o{constructor(t){this.version=e.getInstance(),this.pageId=t}back(){var e;if(this.pageId){const t=null===(e=this.version.pages)||void 0===e?void 0:e.find((e=>e.PageId===this.pageId));t&&("Home"===t.PageName?(new b).init():new c(t.PageId).init())}}}class l{constructor(e,t){this.page=e,this.pageTitle=t,this.appBar=document.createElement("div"),this.init()}init(){this.appBar.classList.add("tbap-app-bar");const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox","0 0 47 47"),e.setAttribute("width","47"),e.setAttribute("height","47"),e.classList.add("content-back-button"),e.innerHTML='\n            <g id="Ellipse_6" data-name="Ellipse 6" fill="none" stroke="#262626" stroke-width="1">\n                <circle cx="23.5" cy="23.5" r="23.5" stroke="none"></circle>\n                <circle cx="23.5" cy="23.5" r="23" fill="none"></circle>\n            </g>\n            <path id="Icon_ionic-ios-arrow-round-up" data-name="Icon ionic-ios-arrow-round-up" d="M13.242,7.334a.919.919,0,0,1-1.294.007L7.667,3.073V19.336a.914.914,0,0,1-1.828,0V3.073L1.557,7.348A.925.925,0,0,1,.263,7.341.91.91,0,0,1,.27,6.054L6.106.26h0A1.026,1.026,0,0,1,6.394.07.872.872,0,0,1,6.746,0a.916.916,0,0,1,.64.26l5.836,5.794A.9.9,0,0,1,13.242,7.334Z" transform="translate(13 30.501) rotate(-90)" fill="#262626"></path>\n        ',e.addEventListener("click",(e=>{e.preventDefault(),this.onBackButtonClicked()}));const t=document.createElement("h1");t.classList.add("title"),t.innerText=this.truncateText(this.pageTitle||this.page.PageName),this.appBar.appendChild(e),this.appBar.appendChild(t)}render(e){e.appendChild(this.appBar)}onBackButtonClicked(){const e=this.getParentId();e&&new o(e).back()}getParentId(){var e;try{let t=JSON.parse(localStorage.getItem("navigation")||'{"history":[]}');if(t.history.length<=0)return;const n=null===(e=t.history.find((e=>e.targetId===this.page.PageId)))||void 0===e?void 0:e.pageId;if(t.history.pop(),localStorage.setItem("navigation",JSON.stringify(t)),n)return n.trim().replace(/^["']|["']$/g,"")}catch(e){console.error("Error navigating back:",e)}return null}truncateText(e,t=20){return e.length>t?e.substring(0,t)+"...":e}}class d{constructor(e){this.page=e,this.pageElement=document.createElement("div"),this.init()}init(){this.pageElement.classList.add("tbap-page-container");const e=new n,t=new l(this.page);let o;e.render(this.pageElement),t.render(this.pageElement),"Calendar"===this.page.PageName?o=new i:"My Activity"===this.page.PageName?o=new r:"Menu"===this.page.PageType?o=new s(this.page):"Content"===this.page.PageType&&(o=new a(this.page)),null==o||o.renderContent(this.pageElement)}render(){document.getElementById("frame").appendChild(this.pageElement)}}class c{constructor(t){this.version=e.getInstance(),this.pageId=t}init(){this.renderUI()}renderUI(){var e;if(this.pageId){const t=null===(e=this.version.pages)||void 0===e?void 0:e.find((e=>e.PageId===this.pageId)),n=document.querySelector(".tbap-page-container");n&&n.remove(),new d(t).render()}}}class h{constructor(e){this.tile=e}renderContent(e){var t,n;if(!(null===(n=null===(t=this.tile)||void 0===t?void 0:t.Action)||void 0===n?void 0:n.ObjectUrl)){const t=document.createElement("div");return t.className="tbap-empty",t.innerText="No content available",void e.appendChild(t)}const i=document.createElement("div");i.className="tbap-weblink-column";const a=document.createElement("object");a.data=this.tile.Action.ObjectUrl,a.type="text/html",a.width="100%",a.height="900px",a.innerHTML=`\n            <p>Unable to display content. \n                <a href="${this.tile.Action.ObjectUrl}" target="_blank">Open in new tab</a>\n            </p>\n        `,i.appendChild(a),e.appendChild(i)}}class p{constructor(e,t){this.page=t,this.tile=e,this.pageElement=document.createElement("div"),this.init()}init(){this.pageElement.classList.add("tbap-page-container");const e=new n,t=new l(this.page,this.tile.Name);let i;e.render(this.pageElement),t.render(this.pageElement),i=new h(this.tile),null==i||i.renderContent(this.pageElement)}render(){document.getElementById("frame").appendChild(this.pageElement)}}class g{constructor(t,n){this.version=e.getInstance(),this.tile=t,this.pageId=n}init(){this.renderUI()}renderUI(){var e;if(this.tile&&this.pageId){const t=null===(e=this.version.pages)||void 0===e?void 0:e.find((e=>e.PageId===this.pageId)),n=document.querySelector(".tbap-page-container");n&&n.remove(),new p(this.tile,t).render()}}}class u{constructor(t){this.version=e.getInstance(),this.tile=t}navigate(){this.tile.Action.ObjectId&&("Web Link"===this.tile.Action.ObjectType?new g(this.tile,this.tile.Action.ObjectId).init():new c(this.tile.Action.ObjectId).init())}}class m{constructor(e,n=!1,i){this.tile=e,this.pageId=i,this.isHighPriority=n,this.themeManager=new t,this.tileContainer=document.createElement("div"),this.init()}init(){this.tileContainer.classList.add("tbap-tile"),this.isHighPriority&&this.tileContainer.classList.add("high-priority-tile");const e="left"===this.tile.Align?"start":"center";this.tileContainer.style.justifyContent=e,this.tileContainer.style.alignItems=e,this.tile.BGImageUrl?(this.tileContainer.style.backgroundImage=`url(${this.tile.BGImageUrl})`,this.tileContainer.style.backgroundColor=`rgba(0,0,0, ${this.tile.Opacity/100})`,this.tileContainer.style.backgroundBlendMode="overlay"):this.tile.BGColor&&(this.tileContainer.style.backgroundColor=this.themeManager.getThemeColor(this.tile.BGColor));const t=document.createElement("div");if(t.classList.add("tile-icon"),t.style.color=this.tile.Color,this.tile.Icon){t.innerHTML=this.themeManager.getThemeIcon(this.tile.Icon);const e=t.querySelector("path");e&&e.setAttribute("fill",this.tile.Color)}const n=document.createElement("div");n.classList.add("tile-title"),n.style.color=this.tile.Color,n.style.textAlign=this.tile.Align,this.tile.Text&&(n.innerHTML=this.tile.Text),this.tileContainer.appendChild(t),this.tileContainer.appendChild(n),this.tileContainer.addEventListener("click",(e=>{if(e.preventDefault(),this.tile.Action.ObjectId){const e=new u(this.tile);this.updateNavigationChain(),e.navigate()}}))}updateNavigationChain(){try{const e=JSON.parse(localStorage.getItem("navigation")||'{"history":[]}');if(!(this.tile&&this.tile.Id&&this.tile.Action&&this.tile.Action.ObjectId))return void console.error("Tile or required properties are missing");const t=e.history.length;e.history.push({pageId:this.pageId,tileId:this.tile.Id,targetId:this.tile.Action.ObjectId,level:t}),localStorage.setItem("navigation",JSON.stringify(e))}catch(e){console.error("Error updating navigation chain:",e)}}getElement(){return this.tileContainer}}class v{constructor(e){this.pageId=e.PageId,this.pageData=e.PageMenuStructure}renderRow(e,t){const n=1===e.Tiles.length,i=t&&n,a=document.createElement("div");return a.className="tbap-row",a.id=e.Id,e.Tiles.forEach(((e,t)=>{const n=new m(e,i&&0===t,this.pageId);a.appendChild(n.getElement())})),a}renderContent(e){var t,n;if(!(null===(n=null===(t=this.pageData)||void 0===t?void 0:t.Rows)||void 0===n?void 0:n.length)){const t=document.createElement("div");return t.className="tbap-empty",t.innerText="No content available",void e.appendChild(t)}const i=document.createElement("div");i.className="tbap-column",this.pageData.Rows.forEach(((e,t)=>{const n=0===t,a=this.renderRow(e,n);i.appendChild(a)})),e.appendChild(i)}}class C{constructor(){this.appBar=document.createElement("div"),this.init()}init(){this.appBar.classList.add("tbap-home-app-bar");const e=document.createElement("div");e.classList.add("logo-section");const t=document.createElement("img");t.src="/Resources/AppPreview/public/logo.png",t.style.height="35px",e.appendChild(t);const n=document.createElement("div");n.classList.add("profile-section"),n.style.display="flex";const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 19.422 21.363"),i.setAttribute("width","16"),i.setAttribute("height","18"),i.setAttribute("fill","none"),i.innerHTML='\n            <path id="Path_1327" data-name="Path 1327" d="M15.711,5a6.8,6.8,0,0,0-3.793,12.442A9.739,9.739,0,0,0,6,26.364H7.942a7.769,7.769,0,1,1,15.537,0h1.942A9.739,9.739,0,0,0,19.5,17.442,6.8,6.8,0,0,0,15.711,5Zm0,1.942A4.855,4.855,0,1,1,10.855,11.8,4.841,4.841,0,0,1,15.711,6.942Z" transform="translate(-6 -5)" fill="#fff"></path>\n        ',n.appendChild(i),this.appBar.appendChild(e),this.appBar.appendChild(n)}render(e){e.appendChild(this.appBar)}}class I{constructor(e){this.page=e,this.homeElement=document.createElement("div"),this.init()}init(){this.homeElement.classList.add("tbap-page-container");const e=new n,t=new C;e.render(this.homeElement),t.render(this.homeElement),new v(this.page).renderContent(this.homeElement)}render(){document.getElementById("frame").appendChild(this.homeElement)}}class b{constructor(){this.version=e.getInstance()}init(){this.renderUI()}renderUI(){if(this.version.homePage){const e=this.version.homePage,t=document.querySelector(".tbap-page-container");t&&t.remove(),new I(e).render(),this.initialiseNavigator(e)}}initialiseNavigator(e){const t={history:[{pageId:e.PageId,targetId:"",tileId:"",level:0}]};localStorage.setItem("navigation",JSON.stringify(t))}}class f{constructor(){this.init()}init(){(new b).init()}}window.PreviewApp=class{constructor(t){e.getInstance().init(t),this.init()}init(){new f}}})();